<!DOCTYPE html>
<html lang="en">

<body>
    <div id="btns">
        <a class="btn">snake</a>
        <a class="btn">step</a>
        <a class="btn">hiphop</a>
        <a class="btn">soul</a>
    </div>
</body>

</html>
<!-- three.min.js r87 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/106/three.min.js"></script>

<!-- GLTFLoader.js -->
<script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r92/examples/js/loaders/GLTFLoader.js"></script>

<!-- FBXLoader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.117.1/examples/jsm/loaders/FBXLoader.js"></script>

<!-- OrbitControls -->
<script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/OrbitControls.js"></script>

<script>
    var scene, camera, renderer, clock, mixer, actions;

    init();

    //FUnction courtesy of Don McCurdy
    function subclip(sourceClip, name, startFrame, endFrame, fps) {

        fps = fps || 30;

        var clip = sourceClip.clone();

        clip.name = name;

        var tracks = [];

        for (var i = 0; i < clip.tracks.length; ++i) {

            var track = clip.tracks[i];
            var valueSize = track.getValueSize();

            var times = [];
            var values = [];

            for (var j = 0; j < track.times.length; ++j) {

                var frame = track.times[j] * fps;

                if (frame < startFrame || frame >= endFrame) continue;

                times.push(track.times[j]);

                for (var k = 0; k < valueSize; ++k) {

                    values.push(track.values[j * valueSize + k]);

                }

            }

            if (times.length === 0) continue;

            track.times = THREE.AnimationUtils.convertArray(times, track.times.constructor);
            track.values = THREE.AnimationUtils.convertArray(values, track.values.constructor);

            tracks.push(track);

        }

        clip.tracks = tracks;

        // find minimum .times value across all tracks in the trimmed clip

        var minStartTime = Infinity;

        for (var i = 0; i < clip.tracks.length; ++i) {

            if (minStartTime > clip.tracks[i].times[0]) {

                minStartTime = clip.tracks[i].times[0];

            }

        }

        // shift all tracks such that clip begins at t=0

        for (var i = 0; i < clip.tracks.length; ++i) {

            clip.tracks[i].shift(-1 * minStartTime);

        }

        clip.resetDuration();

        return clip;

    }

    function init() {
        const assetPath = 'https://cdn.jsdelivr.net/gh/topfyplus/Maneki-neko@89ea9f181d2a61b4cbef6872f184dd6dbf13b8c0/';

        clock = new THREE.Clock();

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x00aaff);

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 2);

        const ambient = new THREE.HemisphereLight(0xffffbb, 0x080820, 2);
        scene.add(ambient);

        const light = new THREE.DirectionalLight(0xFFFFFF, 1.5);
        light.position.set(0, 1, 10);
        scene.add(light);

        const light2 = new THREE.DirectionalLight(0xFFFFFF, 1);
        light2.position.set(10, 5, 10);
        //scene.add(light2);

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 0.7, 0);
        controls.update();

        //Add button actions here
        let index = 0;
        const btns = document.getElementById("btns");
        btns.childNodes.forEach(btn => {
            if (btn.innerHTML !== undefined) {
                btn.addEventListener('click',
                    playAction.bind(this, index)
                );
                index++;
            }
        });

        const anims = [{
                start: 0,
                end: 458,
                name: "snake",
                loop: true
            },
            {
                start: 0,
                end: 234,
                name: "step",
                loop: false,
                next: 0
            },
            {
                start: 0,
                end: 183,
                name: "hiphop",
                loop: false,
                next: 0
            },
            {
                start: 0,
                end: 482,
                name: "soul",
                loop: false
            },
        ];
        //Load meshes here
        const loader = new THREE.GLTFLoader();
        loader.setPath(assetPath);

        loader.load('neko.glb', object => {
            mixer = new THREE.AnimationMixer(object.scene);
            mixer.addEventListener('finished', e => {
                if (e.action.next != undefined) playAction(e.action.next);
            });
            object.scene.children[0].rotation.x = 0;
            actions = [];

            anims.forEach(anim => {
                const clip = subclip(object.animations[0], anim.name, anim.start, anim.end);
                const action = mixer.clipAction(clip);
                if (!anim.loop) {
                    action.loop = THREE.LoopOnce;
                    action.clampWhenFinished = true;
                }
                if (anim.next != undefined) action.next = anim.next;
                actions.push(action);
            });

            actions[0].play();

            scene.add(object.scene);
            update();
        });

        window.addEventListener('resize', resize, false);

    }

    function playAction(index) {
        const action = actions[index];
        mixer.stopAllAction();
        action.reset();
        action.fadeIn(0.5);
        action.play();
    }

    function update() {
        requestAnimationFrame(update);
        renderer.render(scene, camera);
        const dt = clock.getDelta();
        mixer.update(dt);
    }

    function resize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
</script>
<style>
    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    #btns {
        position: absolute;
        right: 10px;
        bottom: 25px;
    }

    .btn {
        background: #EC5060;
        padding: 15px;
        font-family: arial;
        border: 4px;
        color: #fff;
        font-size: 21px;
        font-weight: 500;
        border-radius: 4px;
    }
</style>